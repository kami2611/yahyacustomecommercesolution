<nav class="mega-nav">
  <div class="container">
    <ul class="nav-categories">
      <% if (typeof categories !== 'undefined' && categories) { %>
        <% 
          // Get only root categories (level 0)
          const rootCategories = categories.filter(cat => cat.level === 0);
        %>
        <% rootCategories.forEach(category => { %>
          <% 
            // Get children of this category
            const children = categories.filter(cat => cat.level === category.level + 1);
          %>
          <li class="nav-category-item" data-category-id="<%= category._id %>">
            <a href="/category/<%= category.slug %>" class="nav-category-link">
              <%= category.name %>
            </a>
            
            <% if (children.length > 0) { %>
              <div class="mega-dropdown">
                <div class="mega-dropdown-content">
                  <% children.forEach(child => { %>
                    <% 
                      // Get grandchildren
                      const grandchildren = categories.filter(cat => cat.level === child.level + 1);
                    %>
                    <div class="mega-column">
                      <a href="/category/<%= child.slug %>" class="mega-column-title">
                        <%= child.name %>
                      </a>
                      <% if (grandchildren.length > 0) { %>
                        <ul class="mega-subcategories">
                          <% grandchildren.forEach(grandchild => { %>
                            <li>
                              <a href="/category/<%= grandchild.slug %>"><%= grandchild.name %></a>
                            </li>
                          <% }) %>
                        </ul>
                      <% } %>
                    </div>
                  <% }) %>
                </div>
              </div>
            <% } %>
          </li>
        <% }) %>
      <% } %>
    </ul>
  </div>
</nav>
